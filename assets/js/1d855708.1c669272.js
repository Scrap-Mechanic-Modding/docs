"use strict";(self.webpackChunksm_docs=self.webpackChunksm_docs||[]).push([[403],{3905:(e,t,n)=>{n.d(t,{Zo:()=>m,kt:()=>b});var r=n(7294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function a(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function o(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?a(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):a(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,r,i=function(e,t){if(null==e)return{};var n,r,i={},a=Object.keys(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(r=0;r<a.length;r++)n=a[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=r.createContext({}),c=function(e){var t=r.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):o(o({},t),e)),n},m=function(e){var t=c(e.components);return r.createElement(s.Provider,{value:t},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},u=r.forwardRef((function(e,t){var n=e.components,i=e.mdxType,a=e.originalType,s=e.parentName,m=l(e,["components","mdxType","originalType","parentName"]),p=c(n),u=i,b=p["".concat(s,".").concat(u)]||p[u]||d[u]||a;return n?r.createElement(b,o(o({ref:t},m),{},{components:n})):r.createElement(b,o({ref:t},m))}));function b(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var a=n.length,o=new Array(a);o[0]=u;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l[p]="string"==typeof e?e:i,o[1]=l;for(var c=2;c<a;c++)o[c]=n[c];return r.createElement.apply(null,o)}return r.createElement.apply(null,n)}u.displayName="MDXCreateElement"},6708:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>s,default:()=>b,frontMatter:()=>l,metadata:()=>c,toc:()=>p});var r=n(7462),i=n(7294),a=n(3905);function o(e){let{data:t,children:n}=e;const r=[];for(const{value:i,bits:m}of t)for(let e=m-1;e>=0;e--)r.push(0!=(i&1<<e));const a=[];for(let i=0;i<r.length;i+=8){let e=0;for(let t=0;t<8;t++)e|=(r[i+t]?1:0)<<7-t;a.push(e)}const o=r.length;for(;r.length%8!=0;)r.push(!1);const l={minWidth:"3ch",textAlign:"center",paddingInline:4},s={textAlign:"center"},c={...l,fontStyle:"italic",opacity:.6,filter:"blur(1px)"};return i.createElement("table",null,i.createElement("thead",null,i.createElement("tr",null,i.createElement("th",null,"Byte Index"),a.map(((e,t)=>i.createElement("th",{key:t,colSpan:8},t)))),i.createElement("tr",null,i.createElement("th",null,"Bit Index"),r.map(((e,t)=>t<o?i.createElement("td",{key:t,style:l},t):i.createElement("td",{key:t,style:c,title:"Padding bit"},t))))),i.createElement("tbody",null,i.createElement("tr",null,i.createElement("th",null,"Bit Value"),r.map(((e,t)=>t<o?i.createElement("td",{key:t,style:l},e?"1":"0"):i.createElement("td",{key:t,style:c,title:"Padding bit"},e?"1":"0")))),i.createElement("tr",null,i.createElement("th",null,"Byte Value"),a.map(((e,t)=>i.createElement("td",{key:t,colSpan:8,style:s},"0x",e.toString(16).toUpperCase().padStart(2,"0"))))),i.createElement("tr",null,i.createElement("th",null,"Field"),t.map(((e,t)=>{let{name:n,bits:r}=e;return i.createElement("td",{key:t,colSpan:r,style:l},n)})),o%8!=0&&i.createElement("td",{colSpan:8-o%8,style:l},"Alignment padding")),n))}const l={title:"BitStream"},s=void 0,c={unversionedId:"networking/common-encoding-patterns/bitstream",id:"networking/common-encoding-patterns/bitstream",title:"BitStream",description:"Scrap Mechanic uses a stream of bits to serialize and deserialize all network packets. Most packets only use whole bytes, but some packets use bits that are not aligned to byte boundaries. This page describes the BitStream format.",source:"@site/docs/networking/common-encoding-patterns/bitstream.mdx",sourceDirName:"networking/common-encoding-patterns",slug:"/networking/common-encoding-patterns/bitstream",permalink:"/docs/networking/common-encoding-patterns/bitstream",draft:!1,editUrl:"https://pr.new/github.com/Scrap-Mechanic-Modding/Scrap-Mechanic-Modding.github.io/blob/main/docs/networking/common-encoding-patterns/bitstream.mdx",tags:[],version:"current",frontMatter:{title:"BitStream"},sidebar:"networkingSidebar",previous:{title:"Common Encoding Patterns",permalink:"/docs/category/common-encoding-patterns"}},m={},p=[{value:"BitStream format",id:"bitstream-format",level:2},{value:"Example 1",id:"example-1",level:3},{value:"Example 2",id:"example-2",level:3}],d={toc:p},u="wrapper";function b(e){let{components:t,...n}=e;return(0,a.kt)(u,(0,r.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,a.kt)("p",null,"Scrap Mechanic uses a stream of bits to serialize and deserialize all network packets. Most packets only use whole bytes, but some packets use bits that are not aligned to byte boundaries. This page describes the BitStream format."),(0,a.kt)("h2",{id:"bitstream-format"},"BitStream format"),(0,a.kt)("p",null,"Internally, the BitStream contains a buffer of bytes and a bit index. The bit index is the number of bits that have been read from or written to the buffer."),(0,a.kt)("p",null,"The BitStream is read and written from left to right. The bit index is incremented after each read or write operation by the number of bits that were read or written."),(0,a.kt)("h3",{id:"example-1"},"Example 1"),(0,a.kt)("p",null,"The following example shows a BitStream with a buffer of 3 bytes. The bit index starts at 0. The following operations are performed:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"An unsigned 8-bit integer with the value ",(0,a.kt)("inlineCode",{parentName:"li"},"0x11")," is written to the BitStream."),(0,a.kt)("li",{parentName:"ol"},"An unsigned 16-bit big-endian integer with the value ",(0,a.kt)("inlineCode",{parentName:"li"},"0x2233")," is written to the BitStream.")),(0,a.kt)("p",null,"The BitStream now contains the following data:"),(0,a.kt)(o,{data:[{name:"8-bit integer",bits:8,value:17},{name:"16-bit integer",bits:16,value:8755}],mdxType:"BitstreamDisplay"}),(0,a.kt)("p",null,"Because only whole bytes were written, the individual bytes of the buffer reflect the bytes that were written. The bit index after the write operations is 24."),(0,a.kt)("h3",{id:"example-2"},"Example 2"),(0,a.kt)("p",null,"The following example shows a BitStream with a buffer of 4 bytes. The bit index starts at 0. The following operations are performed:"),(0,a.kt)("ol",null,(0,a.kt)("li",{parentName:"ol"},"A boolean flag bit with the value ",(0,a.kt)("inlineCode",{parentName:"li"},"1")," is written to the BitStream."),(0,a.kt)("li",{parentName:"ol"},"An unsigned 8-bit integer with the value ",(0,a.kt)("inlineCode",{parentName:"li"},"0x11")," is written to the BitStream."),(0,a.kt)("li",{parentName:"ol"},"An unsigned 16-bit big-endian integer with the value ",(0,a.kt)("inlineCode",{parentName:"li"},"0x2233")," is written to the BitStream.")),(0,a.kt)("p",null,"The BitStream now contains the following data:"),(0,a.kt)(o,{data:[{name:"bool",bits:1,value:1},{name:"8-bit integer",bits:8,value:17},{name:"16-bit integer",bits:16,value:8755}],mdxType:"BitstreamDisplay"}),(0,a.kt)("p",null,"Notice how the boolean flag bit is stored in the first bit of the first byte, offsetting the other bits by 1. It is now very difficult to see where the individual bytes start and end. The bit index after the write operations is 25."))}b.isMDXComponent=!0}}]);